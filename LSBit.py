from Crypto.PublicKey import *
from Crypto.Util.number import *
from Server import *
from pwn import *

# n = 120357855677795403326899325832599223460081551820351966764960386843755808156627131345464795713923271678835256422889567749230248389850643801263972231981347496433824450373318688699355320061986161918732508402417281836789242987168090513784426195519707785324458125521673657185406738054328228404365636320530340758959
# e = 65537
# ctext = long_to_bytes(2201077887205099886799419505257984908140690335465327695978150425602737431754769971309809434546937184700758848191008699273369652758836177602723960420562062515168299835193154932988833308912059796574355781073624762083196012981428684386588839182461902362533633141657081892129830969230482783192049720588548332813)
ctext=ctext.decode('hex')

upperLimit = n
lowerLimit = 0

for i in range(1,1034):
	chosen_ct = long_to_bytes((bytes_to_long(ctext)*pow(2**i,e,n))%n)
	decrypted_text = decrypt(chosen_ct, d, n)
	# print(decrypted_text)
	if ord(decrypted_text[-1]) == 0:
		upperLimit = (upperLimit + lowerLimit)/2

	elif ord(decrypted_text[-1]) == 1:
		lowerLimit = (upperLimit + lowerLimit)/2
	
	else:
		print("[.] Unrecognized plaintext format!!")
		print("[.] Exiting.....")

print(long_to_bytes(upperLimit))


